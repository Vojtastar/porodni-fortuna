<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>PorodnÃ­ Fortuna ğŸ€</title>
<style>
body { font-family: Arial, sans-serif; max-width: 500px; margin: 40px auto; background-color: #f0fff0; padding: 20px; border-radius: 12px; box-shadow: 0 0 15px rgba(0,0,0,0.1);}
h2 { text-align: center; color: #2e7d32; }
p { font-size: 16px; line-height: 1.5; }
input, button { width: 100%; padding: 10px; margin: 6px 0; border-radius: 6px; border: 1px solid #2e7d32; }
button { background-color: #2e7d32; color: white; cursor: pointer; }
button:hover { background-color: #1b5e20; }
ul { padding-left: 20px; }
li { margin-bottom: 6px; }
.actions button { width: auto; margin-left: 6px; padding: 4px 8px; font-size: 14px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
table, th, td { border: 1px solid #2e7d32; }
th, td { padding: 6px; text-align: center; }
</style>
</head>
<body>

<h2>PorodnÃ­ Fortuna ğŸ€</h2>

<p>
MilÃ­ kamarÃ¡di a rodino! ğŸ‰<br>
Zveme vÃ¡s, abyste si vsadili na datum porodu a tipovanÃ© jmÃ©no naÅ¡eho miminka. 
Vyberte datum mezi <strong>7. 2. 2026</strong> a <strong>28. 2. 2026</strong>, napiÅ¡te svÃ© jmÃ©no a tipovanÃ© jmÃ©no miminka. 
VÃ½herce bude odmÄ›nÄ›n lÃ¡hvÃ­ <strong>alkomoku</strong>! ğŸ¾<br>
AÅ¥ se zelenÃ¡ âœ…ğŸ“ˆğŸ’šğŸ’–ğŸ€
</p>

<input type="text" id="player" placeholder="Tvoje jmÃ©no">
<input type="text" id="babyName" placeholder="TipovanÃ© jmÃ©no miminka">
<input type="date" id="date" min="2026-02-07" max="2026-02-28">

<button onclick="saveTip()">UloÅ¾it tip</button>

<h3>VsazenÃ© tipy:</h3>
<ul id="list"></ul>

<h3>Kurzy podle Äetnosti tipÅ¯</h3>
<table>
    <thead>
        <tr>
            <th>Datum</th>
            <th>Dny od termÃ­nu</th>
            <th>Kurz</th>
        </tr>
    </thead>
    <tbody id="odds"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

// Firebase konfigurace
const firebaseConfig = {
  apiKey: "AIzaSyDRReoW_oKVWmHxrDJlszanlaWFQvN38tY",
  authDomain: "porodni-fortuna.firebaseapp.com",
  databaseURL: "https://porodni-fortuna-default-rtdb.firebaseio.com",
  projectId: "porodni-fortuna",
  storageBucket: "porodni-fortuna.firebasestorage.app",
  messagingSenderId: "312677466546",
  appId: "1:312677466546:web:cc89ab54112b80520124ab"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let minOdds = 1.05, maxOdds = 5.0;
const oddsTable = document.getElementById("odds");
const start = new Date("2026-02-07");
const end = new Date("2026-02-28");
const dueDate = new Date("2026-02-16");
let days = [];
for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
    const diffDays = Math.abs(Math.round((d - dueDate)/(1000*60*60*24)));
    days.push({ date: new Date(d), diff: diffDays, currentOdds: maxOdds });
}

const tipsList = document.getElementById("list");

function saveTip() {
    const player = document.getElementById("player").value.trim();
    const babyName = document.getElementById("babyName").value.trim();
    const date = document.getElementById("date").value;
    if (!player || !babyName || !date) { alert("VyplÅˆ vÅ¡echna pole!"); return; }
    push(ref(db, 'tips'), { owner: player, babyName, date });
    clearForm();
}

function clearForm() {
    document.getElementById("player").value = "";
    document.getElementById("babyName").value = "";
    document.getElementById("date").value = "";
}

onValue(ref(db, 'tips'), snapshot => {
    const tips = snapshot.val() || {};
    tipsList.innerHTML = "";
    Object.keys(tips).forEach(key => {
        const tip = tips[key];
        const li = document.createElement("li");

        const span = document.createElement("span");
        span.textContent = `${tip.owner} tipuje: ${tip.babyName} â€“ ${tip.date}`;

        const actions = document.createElement("span");
        actions.className = "actions";
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Smazat";
        deleteBtn.onclick = () => {
            remove(ref(db, 'tips/' + key));
        };
        actions.appendChild(deleteBtn);

        li.appendChild(span);
        li.appendChild(actions);
        tipsList.appendChild(li);
    });
    calculateOdds(tips);
});

function calculateOdds(tips) {
    const dateCounts = {};
    days.forEach(d => dateCounts[d.date.toISOString().slice(0,10)] = 0);

    Object.values(tips).forEach(tip => {
        if (dateCounts[tip.date] !== undefined) dateCounts[tip.date]++;
    });

    const maxCount = Math.max(...Object.values(dateCounts),1);

    days.forEach(d => {
        const count = dateCounts[d.date.toISOString().slice(0,10)];
        d.currentOdds = (maxOdds - (maxOdds - minOdds) * (count / maxCount)).toFixed(2);
    });

    renderOdds();
}

function renderOdds() {
    oddsTable.innerHTML = "";
    days.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${d.date.toISOString().slice(0,10)}</td><td>${d.diff}</td><td>${d.currentOdds}</td>`;
        oddsTable.appendChild(tr);
    });
}
</script>

</body>
</html>
